<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Stocks - Ferme Mokpokpo</title>
    <link rel="icon" type="image/png" href="assets/img/favicon.png">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/stock.css">
    <link rel="stylesheet" href="css/responsive.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Style rapide pour le formulaire d'inventaire intégré */
        .inventory-form-container {
            background: #f1f8ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #cce5ff;
        }

        .inv-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: end;
        }
    </style>
</head>

<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-fish"></i>
                    <h2>Ferme Mokpokpo</h2>
                </div>
            </div>

            <nav class="sidebar-menu">
                <a href="catalogue.html" class="menu-item">
                    <i class="fas fa-book-open menu-icon"></i>
                    <span class="menu-text">Catalogue</span>
                </a>
                <a href="stock.html" class="menu-item active">
                    <i class="fas fa-boxes menu-icon"></i>
                    <span class="menu-text">Gestion Stock</span>
                </a>
                <a href="alertes.html" class="menu-item">
                    <i class="fas fa-exclamation-triangle menu-icon"></i>
                    <span class="menu-text">Alertes Stock</span>
                </a>
                <a href="notifications.html" class="menu-item">
                    <i class="fas fa-bell menu-icon"></i>
                    <span class="menu-text">Notifications</span>
                </a>
                <div class="menu-spacer"></div>
                <a href="#" class="menu-item logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt menu-icon"></i>
                    <span class="menu-text">Déconnexion</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="topbar">
                <div class="topbar-title">
                    <h1><i class="fas fa-boxes"></i> Gestion des Stocks</h1>
                </div>
                <div class="user-info">
                    <span id="current-user">Gestionnaire Stock</span>
                </div>
            </header>

            <div class="content-area">

                <div class="action-section" style="margin-bottom: 30px; display: flex; justify-content: flex-end;">
                    <a href="formulaire_stock.html" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus-circle"></i> Ajouter un Nouveau Stock
                    </a>
                </div>

                <div class="inventory-section">
                    <h3><i class="fas fa-clipboard-check"></i> Saisir Inventaire du Jour</h3>

                    <div class="inventory-form-container">
                        <form id="daily-inventory-form">
                            <div class="inv-grid">
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" id="inv-date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Stock Entrée (kg)</label>
                                    <input type="number" id="inv-entree" class="form-control" placeholder="0" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Stock Sorti (kg)</label>
                                    <input type="number" id="inv-sortie" class="form-control" placeholder="0" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Disponible ?</label>
                                    <select id="inv-dispo" class="form-control">
                                        <option value="Oui">Oui</option>
                                        <option value="Non">Non</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>En Rupture ?</label>
                                    <select id="inv-rupture" class="form-control">
                                        <option value="Non">Non</option>
                                        <option value="Oui">Oui</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-success btn-block">
                                        <i class="fas fa-save"></i> Enregistrer
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <h4>Récapitulatif Inventaire</h4>
                    <div class="table-container">
                        <table class="stock-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Stock Entrée (kg)</th>
                                    <th>Stock Sortis (kg)</th>
                                    <th>Disponible</th>
                                    <th>Rupture</th>
                                </tr>
                            </thead>
                            <tbody id="daily-inventory-body">
                                <tr>
                                    <td colspan="5" class="loading-row">
                                        <i class="fas fa-spinner fa-spin"></i> Chargement...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="stock-list-section">
                    <div class="section-header"
                        style="display:flex; justify-content:space-between; align-items:center;">
                        <h3><i class="fas fa-history"></i> Historique des Lots Ajoutés</h3>
                        <button class="btn btn-sm btn-outline" onclick="loadStockData()">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="stock-table">
                            <thead>
                                <tr>
                                    <th>Stock (ID)</th>
                                    <th>Type / Produit</th>
                                    <th>Quantité Initiale</th>
                                    <th>Date Entrée</th>
                                    <th>Disponibilité</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="stock-history-body">
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/security.js"></script>
    <script src="js/stock.js"></script>

    <script>
        // Petit script inline pour gérer la soumission du NOUVEAU formulaire d'inventaire
        // sans toucher au fichier stock.js principal pour l'instant
        document.addEventListener('DOMContentLoaded', () => {
            // Mettre la date du jour par défaut
            const dateInput = document.getElementById('inv-date');
            if (dateInput) {
                dateInput.valueAsDate = new Date();
            }

            const dailyForm = document.getElementById('daily-inventory-form');
            if (dailyForm) {
                dailyForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const data = {
                        date: document.getElementById('inv-date').value,
                        entree: document.getElementById('inv-entree').value,
                        sortie: document.getElementById('inv-sortie').value,
                        disponible: document.getElementById('inv-dispo').value,
                        rupture: document.getElementById('inv-rupture').value
                    };

                    // Ici, on utiliserait api.request pour envoyer au backend
                    // Pour l'instant, on simule l'ajout visuel
                    console.log("Inventaire soumis :", data);

                    try {
                        // Simulation d'envoi API si possible, sinon simple message
                        // await api.request('/api/stocks/inventaire-quotidien/', { method: 'POST', body: JSON.stringify(data) });
                        alert("Inventaire enregistré (Simulation)");

                        // Recharger les données (appel à la fonction existante dans stock.js)
                        if (typeof loadStockData === 'function') loadStockData();
                    } catch (error) {
                        alert("Erreur lors de l'enregistrement");
                    }
                });
            }
        });
    </script>
</body>

</html>